<template>
    <Page>
        <PlatformHeader :title="_L('appSettings.appearance.language')" :canNavigateBack="true" :canNavigateSettings="false" />
        <SettingsLayout :scrollable="true">
            <StackLayout>
                <GridLayout columns="30,*" class="top-bordered-item p-t-30 p-b-10" @tap="selectLanguage('en')">
                    <CheckBox
                        row="0"
                        col="0"
                        :class="this.isIOS ? 'm-l-5' : ''"
                        :checked="this.currentSettings.appearance.language == 'en'"
                        fillColor="#2c3e50"
                        onCheckColor="#2c3e50"
                        onTintColor="#d8dce0"
                        fontSize="16"
                        boxType="circle"
                        @tap="selectLanguage('en')"
                    />
                    <Label row="0" col="1" class="size-16 m-t-5 m-l-5" :text="_L('appSettings.appearance.english')"></Label>
                </GridLayout>
                <GridLayout columns="30,*" class="p-t-10 p-b-10" @tap="selectLanguage('es')">
                    <CheckBox
                        row="0"
                        col="0"
                        :class="this.isIOS ? 'm-l-5' : ''"
                        :checked="this.currentSettings.appearance.language == 'es'"
                        fillColor="#2c3e50"
                        onCheckColor="#2c3e50"
                        onTintColor="#d8dce0"
                        fontSize="15"
                        boxType="circle"
                        @tap="selectLanguage('es')"
                    />
                    <Label row="0" col="1" class="size-16 m-t-5 m-l-5" :text="_L('appSettings.appearance.spanish')"></Label>
                </GridLayout>
            </StackLayout>
        </SettingsLayout>
    </Page>
</template>
<script lang="ts">
import Vue from "vue";
import { ActionTypes } from "@/store/actions";
import { isIOS } from "@nativescript/core";
import SharedComponents from "@/components/shared";
import { routes } from "~/routes";
import { changeLanguageI18n } from "~/lib/i18n";
import { getBus } from "~/components/NavigationBus";

export default Vue.extend({
    computed: {
        currentSettings(this: any) {
            return this.$s.state.portal.settings;
        },
        isIOS(): boolean {
            return isIOS;
        },
    },
    components: {
        ...SharedComponents,
    },
    methods: {
        async saveSettings(): Promise<void> {
            await this.$s.dispatch(ActionTypes.UPDATE_SETTINGS, this.currentSettings);
            getBus().$emit("nav:tabs-reload");
            await this.$deprecatedNavigateTo(routes.appSettings.appearanceLanguage, {});
        },
        async selectLanguage(language): Promise<void> {
            this.currentSettings.appearance.language = language;
            changeLanguageI18n(language);
            await this.saveSettings();
        },
    },
});
</script>
<style scoped lang="scss">
@import "~/_app-variables";

.top-bordered-item {
    border-top-color: $fk-gray-lighter;
    border-top-width: 1;
}
</style>
